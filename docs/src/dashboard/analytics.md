# 用量分析

用量分析页面提供基于时间维度的深度数据洞察，帮助您理解流量模式、成本分布和性能瓶颈。

## 时间范围选择

页面右上角提供时间范围下拉菜单，支持：
- **7 天**：查看最近一周的详细趋势
- **14 天**：查看两周的中期趋势
- **30 天**：查看一个月的长期趋势
- **90 天**：查看一个季度的宏观趋势

选择后会自动刷新所有图表数据。

## 核心指标卡片

页面顶部展示四个关键指标：

| 指标 | 描述 | 图标 |
|------|------|------|
| 总请求 | 选定时间段的累计请求数 | 📊 Activity |
| 成功率 | API 请求的成功百分比 | ✅ CheckCircle |
| 平均延迟 | 平均响应时间（秒） | ⚡ Zap |
| 总 Token | 选定时间段消耗的总 Token 数 | 🎯 Target |

每个指标卡片显示数值和趋势变化（相比上一周期）。

## 主要图表

### 请求趋势图
展示请求量的时间分布，支持两种图表类型切换：

- **柱状图 (Bar)**：显示每天的请求总量
- **折线图 (Line)**：显示请求趋势和成功请求数

双系列显示：
- 🔵 **请求**：总请求数量（柱状/折线）
- 🟢 **成功**：成功请求数量（折线叠加）

### 错误分布图
堆叠柱状图按 HTTP 状态码分类展示错误数量：

常见状态码及含义：
- **429**：速率限制（Too Many Requests）
- **500**：服务器内部错误
- **400**：客户端请求错误
- **401**：认证失败

**关键提示**：持续观察 429 错误，可能需要增加 API Key 或优化轮询策略。

### 提供商分布
环形饼图展示各提供商的流量占比：

- 点击图例可显示/隐藏对应数据
- 悬停显示具体数量和百分比
- 自动计算各提供商的请求数量

### 延迟分布
柱状图展示请求延迟的分布区间：
- **X 轴**：延迟区间（如 0-1s、1-2s 等）
- **Y 轴**：该区间的请求数量

帮助识别性能瓶颈（如大量请求集中在高延迟区间）。

### 模型性能雷达图
**模型选择器**：下拉选择具体的模型进行深度分析

雷达图展示四个维度的性能指标：
- **请求数**：该模型的调用次数
- **输入 Token**：输入侧 Token 消耗
- **输出 Token**：输出侧 Token 消耗
- **总 Token**：总 Token 消耗

所有数值相对于最大值的百分比显示。

### 使用热力图
展示一天 24 小时的请求活跃度：

- **X 轴**：0:00 - 23:00（按小时）
- **Y 轴**：日期
- **颜色深度**：请求量（绿色越深 = 越活跃）

帮助识别高峰时段，合理分配资源。

## 峰值监控

### RPM 峰值
- 显示选定时间段内的每分钟最大请求数
- 曲线图展示最近 30 分钟的 RPM 变化趋势
- 副标题显示峰值数值

### TPM 峰值
- 显示选定时间段内的每分钟最大 Token 消耗
- 曲线图展示最近 30 分钟的 TPM 变化趋势
- 副标题显示峰值数值

### RPD 总计
- 显示选定时间段内平均每天的请求数
- 曲线图展示每天的请求数趋势

**为什么关注峰值？**

很多 AI 提供商（如 OpenAI）的速率限制是基于 RPM/TPM 的。平均值可能看起来很低（例如平均 10 RPM），但如果某一分钟突然飙升到 1000 RPM，依然会触发限流错误。通过峰值监控，您可以：
- 合理规划容量
- 设置预警阈值
- 优化流量分配

## 详细数据表格

页面底部提供可展开的详细数据表格：

| 列名 | 描述 |
|------|------|
| 日期 | 统计日期 |
| 请求 | 当天总请求数 |
| 成功 | 当天成功请求数（绿色显示） |
| 失败 | 当天失败请求数（红色显示） |
| 成功率 | 当天成功率百分比（>=95% 为绿色，否则黄色） |

**操作**：
- 点击右上角"展开/收起"切换显示
- 表格支持水平滚动（移动端适配）

## 数据导出

点击页面右上角"导出"按钮：
- 下载当前时间范围的完整分析数据
- 格式：JSON
- 文件名：`analytics-{天数}days-{日期}.json`

导出的数据可用于：
- 自定义分析
- 数据可视化工具导入
- 审计报告
