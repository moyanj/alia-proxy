# 日志管理

日志系统是您排查问题、审计合规和收集数据最得力的助手。它不仅记录了元数据，还完整保存了对话内容。

## 日志列表与筛选

### 筛选器

| 筛选条件 | 类型 | 说明 |
|----------|------|------|
| 提供商 | 下拉选择 | 如 `openai-main`、`anthropic-backup`，支持"全部" |
| 模型名称 | 文本搜索 | 支持模糊搜索，如输入 `gpt-4` 匹配所有相关模型 |
| 状态码 | 数字输入 | 快速查找失败的请求（如输入 `500`） |

### 列表信息

每条日志显示以下信息：

| 列名 | 描述 |
|------|------|
| 时间 | 日期 + 时间戳（双行显示） |
| 模型/提供商 | 模型名称（加粗）+ 提供商标签（蓝色胶囊） |
| 端点 | API 端点类型（如 `chat/completions`） |
| 消耗 | 总 Token 数 + 分解显示（Prompt + Completion） |
| 延迟 | 响应时间（秒），带时钟图标 |
| 状态 | HTTP 状态码，带颜色指示（绿/黄/红） |
| 操作 | "详情"按钮 |

### 分页

- 每页显示 20 条记录
- 底部显示当前范围（如 "Showing 1-20"）
- 左右箭头切换页码

### 批量操作

- **导出 CSV**：点击下载图标，导出当前筛选条件的数据
- **清空日志**：点击垃圾桶图标，删除当前筛选条件的所有日志（需要确认）

## 日志详情侧边栏

点击任意日志的"详情"按钮，右侧会滑出详细信息面板。

### 基础信息面板

| 字段 | 描述 |
|------|------|
| Request ID | 唯一请求标识符（点击可复制） |
| Status | HTTP 状态码（胶囊样式，带颜色） |

### 元数据网格

| 字段 | 描述 |
|------|------|
| Provider | AI 提供商名称 |
| Model | 实际使用的模型 |
| Latency | 响应延迟（秒，3 位小数） |
| Tokens | 总 Token 消耗 |

### 对话内容还原

#### 用户提示词
- **Role 标签**：显示每条消息的角色（User / System）
- **消息内容**：原始文本格式显示
- **Copy JSON**：一键复制原始 JSON 数据

#### 模型响应
- **Markdown 渲染**：自动渲染代码高亮、表格、列表等
- **Copy Text**：一键复制纯文本响应
- **样式**：使用 Prose 样式，支持深色模式

#### 错误详情（仅错误时显示）
- **红色警告框**：突出显示错误信息
- **原始错误**：显示上游返回的完整错误堆栈

## 操作按钮

详情面板右上角提供快捷操作：

| 按钮 | 功能 |
|------|------|
| Playground | 将该日志完整加载到演练场，方便复现 |
| 删除 | 删除单条日志（需要确认） |

## 日志删除

### 单条删除
1. 在列表中点击"详情"
2. 在侧边栏点击右上角删除图标
3. 确认后删除

### 批量清空
1. 在列表页面设置筛选条件
2. 点击右上角垃圾桶图标
3. 确认后删除所有符合条件的数据

**注意**：删除操作不可恢复，请谨慎操作。

## 数据导出

### CSV 导出
点击页面右上角下载图标：
- 导出当前筛选条件的所有日志
- 格式：CSV（逗号分隔值）
- 可用 Excel、Google Sheets 等工具打开

### API 端点
也可以直接通过 API 端点导出：
```
GET /api/export?format=csv
```

## 日志查找技巧

### 快速定位失败请求
1. 在"状态码"筛选器中输入 `4` 或 `5`
2. 点击"查询"
3. 查看错误详情面板的错误堆栈

### 分析特定模型
1. 在"模型名称"中输入模型关键词（如 `gpt-4`）
2. 查看该模型的响应时间和 Token 消耗
3. 对比不同模型的性能

### 追踪高延迟问题
1. 筛选特定提供商
2. 按延迟排序（前端暂不支持，可导出后用 Excel 排序）
3. 检查高延迟日志的详情

## 多模态支持

日志系统支持多种内容类型的记录和展示：

- **文本对话**：完整记录 Prompt 和 Response
- **图片生成**：保存生成的图片文件路径（在 `data/media/` 目录）
- **语音合成 (TTS)**：保存生成的音频文件路径
- **多模态输入**：支持带图片的 Vision 请求（Base64 或本地文件）

**注意**：多模态内容的展示需要后端媒体存储服务支持，当前版本已集成媒体文件服务。
